# =============================================================================
# NEXUS AI GATEWAY v2.1 - Environment Configuration (2026)
# Production-Ready with Circuit Breaker & Graceful Shutdown
# =============================================================================

PORT=3000

# -----------------------------------------------------------------------------
# SECURITY & CORS
# -----------------------------------------------------------------------------

# CORS origin. Use "*" for development, specific domain for production.
# Example: https://myapp.com
CORS_ORIGIN=*

# -----------------------------------------------------------------------------
# TIMEOUTS & PERFORMANCE
# -----------------------------------------------------------------------------

# Timeout (ms) for the first streamed token before failing over to next provider.
# Set to 0 to disable. Recommended: 8000 for production.
FIRST_TOKEN_TIMEOUT_MS=8000

# Graceful shutdown timeout (ms). Max time to wait for in-flight requests.
SHUTDOWN_TIMEOUT_MS=10000

# -----------------------------------------------------------------------------
# GROQ CONFIGURATION
# Default model: llama-4-scout-17b-16e-instruct (10M context, multimodal)
# Alternatives: llama-4-maverick (1M context, chat), llama-3.3-70b-versatile
# -----------------------------------------------------------------------------
GROQ_MODEL=llama-4-scout-17b-16e-instruct

GROQ_KEY_1=gsk_...
GROQ_KEY_2=gsk_...
GROQ_KEY_3=gsk_...

# -----------------------------------------------------------------------------
# GEMINI CONFIGURATION
# Default model: gemini-2.5-flash (thinking model, 65K output)
# Alternatives: gemini-3-flash-preview (frontier-class), gemini-2.5-flash-lite
# -----------------------------------------------------------------------------
GEMINI_MODEL=gemini-2.5-flash

GEMINI_KEY_1=AIza...
GEMINI_KEY_2=AIza...

# -----------------------------------------------------------------------------
# OPENROUTER CONFIGURATION
# Default model: deepseek/deepseek-r1-0528:free
# Free alternatives:
#   - tng/deepseek-r1t-chimera:free (hybrid R1+V3, better reasoning)
#   - xiaomi/mimo-v2-flash:free (top SWE-bench)
#   - mistral/devstral-2-2512:free (code specialist, 256K context)
# -----------------------------------------------------------------------------
OPENROUTER_MODEL=deepseek/deepseek-r1-0528:free
OPENROUTER_HTTP_REFERER=http://localhost
OPENROUTER_X_TITLE=Nexus AI Gateway

OPENROUTER_KEY_1=sk-or-v1-...
OPENROUTER_KEY_2=sk-or-v1-...

# -----------------------------------------------------------------------------
# CEREBRAS CONFIGURATION
# Default model: zai-glm-4.7 (~1,000-1,700 tok/s on WSE-3 hardware)
# ⚠️ NOTE: zai-glm-4.6 was DEPRECATED on January 20, 2026
# -----------------------------------------------------------------------------
CEREBRAS_MODEL=zai-glm-4.7

CEREBRAS_KEY_1=...
CEREBRAS_KEY_2=...

# -----------------------------------------------------------------------------
# BACKWARDS-COMPATIBLE ALIASES (optional)
# -----------------------------------------------------------------------------
# GROQ_API_KEY_1=gsk_...
# GEMINI_API_KEY_1=AIza...
# OPENROUTER_API_KEY_1=sk-or-v1-...
# CEREBRAS_API_KEY_1=...

# =============================================================================
# v2.1 PRODUCTION FEATURES
# =============================================================================
#
# CIRCUIT BREAKER:
# - Opens after 3 consecutive failures
# - Stays open for 60 seconds, then enters HALF_OPEN
# - 1 test request allowed in HALF_OPEN
# - Success closes circuit, failure reopens it
#
# EXPONENTIAL BACKOFF:
# - Initial delay: 100ms
# - Max delay: 2000ms
# - Multiplier: 2x per retry
# - Sequence: 100ms → 200ms → 400ms → 800ms → 1600ms → 2000ms
#
# GRACEFUL SHUTDOWN:
# - Handles SIGTERM and SIGINT signals
# - Stops accepting new requests immediately
# - Waits up to 10 seconds for in-flight requests
# - New requests during shutdown receive 503 with Retry-After header
#
# HEALTH ENDPOINT (GET /health):
# - Shows circuit breaker state for each provider
# - Shows in-flight request count
# - Shows shutdown status
# - Use for Kubernetes liveness/readiness probes
#
# =============================================================================
